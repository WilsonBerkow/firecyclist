<!DOCTYPE html>
<html>
    <head>
        <title>Firecyclist</title>
        <meta charset="UTF-8"/>
        <style>
            html, body {
                text-align: center;
                margin: 0;
                padding: 0;
                user-select: none;
                cursor: default;
                background: black;
                overflow: hidden;
            }
            #Main {
              background: white;
            }
        </style>
    </head>
    <body data-role="page">
        <div id="Main"></div>
        <script src="jquery-1.11.2.min.js"></script>
        <script src="jquery.mobile-1.4.5.min.js"></script>
        <script src="elm.js"></script>
        <script>
            (function () {
                var module = Elm.embed(Elm.Main, jQuery('#Main')[0], {taps: null, modtouches: []}),
                    pageScaleFactor = 1,
                    moduleOffsetX = 0,
                    resize = function () { // This zooms the page so that the Firecyclist module (initially always (576/2) by (1024/2) in dimensions), fits to the page.
                        var scaleX = jQuery(window).width() / (576 / 2),
                            scaleY = jQuery(window).height() / (1024 / 2),
                            unfitAxis;
                        pageScaleFactor = Math.min(scaleX, scaleY);
                        unfitAxis = pageScaleFactor === scaleX ? "y" : "x";
                        jQuery("body")
                            .css("-moz-transform-origin", "0 0")
                            .css("-moz-transform", "scale(" + pageScaleFactor + ")")
                            .css("-webkit-transform-origin", "0 0")
                            .css("-webkit-transform", "scale(" + pageScaleFactor + ")")
                            .css("-ms-transform-origin", "0 0")
                            .css("-ms-transform", "scale(" + pageScaleFactor + ")");
                        jQuery(document).width(576 / 2).height(1024 / 2);
                        if (unfitAxis === "x") {
                            moduleOffsetX = ((jQuery("body").width() - (576 / 2) * pageScaleFactor) / 2) / pageScaleFactor; // The last division, by pageScaleFactor, is there because the zoom done above will automatically scale this whole expression/offest by pageScaleFactor, so the division undoes that.
                            jQuery("#Main").css("position", "absolute").css("left", moduleOffsetX);
                        }
                    },
                    transform = function (coordinate) { return coordinate / pageScaleFactor; }, // For converting tap and touch event values, so that the visual zoom of the page registers in where the program sees the taps happening.
                    transformTouch = function (touch) {
                        // Note that below, the transformations on x's and y's only handle the scale factor
                        //  of the entire page, and not the offset of the module, used to center it. This
                        //  is because the 'touch' comes from Elm's Touch module, which gives coordinates
                        //  relative to the top-left of the Elm module by default.
                        // However, for the 'taps' port, handled below, I *do* handle the x-axis offset.
                        return {
                            "x": transform(touch.x),
                            "y": transform(touch.y),
                            "x0": transform(touch.x0),
                            "y0": transform(touch.y0),
                            "t0": touch.t0,
                            "id": touch.id
                        };
                    };
                resize();
                jQuery(document).tap(function (event) {
                    module.ports.taps.send({
                        "x": transform(event.pageX) - moduleOffsetX,
                        "y": transform(event.pageY)
                    });
                });
                module.ports.touches.subscribe(function (event) {
                    module.ports.modtouches.send(event.map(transformTouch));
                });
            }());
        </script>
    </body>
</html>